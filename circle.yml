checkout:
    pre:
        - sudo apt-add-repository -y 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise-3.4 main'
        - wget -q -O - http://llvm.org/apt/llvm-snapshot.gpg.key | sudo apt-key add -
        - sudo apt-get update
        - sudo apt-get install clang-3.4 clang-3.4-doc libclang-common-3.4-dev libclang-3.4-dev libclang1-3.4 libclang1-3.4-dbg libllvm3.4 libllvm3.4-dbg llvm-3.4 llvm-3.4-dev llvm-3.4-doc llvm-3.4-examples llvm-3.4-runtime cpp11-migrate-3.4 clang-format-3.4
    post:
        - cd ..; hg clone https://hg.mozilla.org/projects/nspr

test:
    override:
        - USE_ASAN=1 make CC=clang-3.4 CCC=clang++-3.4 nss_build_all
        - cd tests; NSS_TESTS=ssl_gtests NSS_CYCLES=standard ./all.sh

machine:
    environment:
        { USE_64: 1,
          NSS_ENABLE_TLS_1_3: 1,
          NSS_BUILD_GTESTS: 1,
        }
    hosts:


